<%= render layout: 'webring/shared/container', locals: {
  title: 'Edit Member',
  description: "Update information for #{@member.name}",
  back_path: member_path(@member)
} do %>
  <div class="flex min-h-screen items-start justify-center">
    <div class="w-full max-w-4xl">
      <div class='border border-black border-[3px] bg-white'>
        <div class='px-4 py-5 sm:p-6'>
          <%= form_with(model: @member,
                       html: {
                         "x-data": %Q({
                           loading: false,
                           hasError: #{@member.errors.any? ? 'true' : 'false'},
                           errorMessages: #{@member.errors.full_messages.to_json.html_safe},

                           clearError() {
                             this.hasError = false;
                             this.errorMessages = [];
                           },

                           get buttonText() {
                             return this.loading ? 'Updating...' : (this.hasError ? 'Fix errors above' : 'Update Member');
                           },

                           get buttonClasses() {
                             if (this.hasError) return 'btn btn-error';
                             if (this.loading) return 'btn btn-loading';
                             return 'btn btn-primary';
                           },

                           handleSubmit() {
                             if (!this.hasError) this.loading = true;
                           }
                         }),
                         "x-on:submit": "handleSubmit()",
                         "x-on:input": "if (hasError) clearError()"
                       }) do |form| %>

            <div x-show="hasError"
                 x-cloak
                 class="border border-red-600 border-[3px] bg-red-50 p-4 mb-6">
              <h3 class="font-semibold text-red-800 mb-2">Please fix the following errors:</h3>
              <ul class="text-sm text-red-700 space-y-1">
                <template x-for="error in errorMessages" :key="error">
                  <li x-text="'â€¢ ' + error"></li>
                </template>
              </ul>
            </div>

            <div class="field mb-4">
              <%= form.label :name, class: "form-label" %>
              <%= form.text_field :name,
                  class: "form-input",
                  placeholder: "Member Name (optional)" %>
              <p class="text-sm text-gray-500 mt-1">The name of the member. If left blank, URL will be used.</p>
            </div>

            <div class="field mb-4">
              <%= form.label :url, class: "form-label" %>
              <%= form.text_field :url,
                  class: "form-input",
                  placeholder: "https://example.com",
                  required: true %>
              <p class="text-sm text-gray-500 mt-1">The URL of the member's website.</p>
            </div>

            <div>
              <%= form.submit "",
                  "x-bind:class": "buttonClasses",
                  "x-bind:disabled": "loading || hasError",
                  "x-bind:value": "buttonText" %>
            </div>

            <div x-show="loading"
                 x-cloak
                 class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-10 pointer-events-none">
              <div class="bg-black text-white px-4 py-2 border-[3px] border-black flex items-center">
                <svg class="animate-spin h-5 w-5 text-white mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                Updating member...
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
